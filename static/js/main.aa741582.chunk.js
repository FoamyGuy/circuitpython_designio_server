(this.webpackJsonpdesign_page=this.webpackJsonpdesign_page||[]).push([[0],{222:function(e,t,n){},223:function(e,t,n){},392:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(28),i=n.n(s),c=(n(222),n(47)),r=n(12),d=n(15),l=n(20),u=n(19),h=(n(223),n(200)),b=n.n(h),g=n(208),p=n.n(g),k=n(209),O=n.n(k),j=n(211),f=n(29),v=n(198),m=n(81),w=n(212),_=n.n(w),S=(n(192),n(196),n(14)),x=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).store=e.store,a}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(S.jsxs)(v.Z,{children:[Object(S.jsxs)(v.Z.Group,{align:m.a.LEFT,children:[Object(S.jsx)(v.b,{icon:"new-object",minimal:!0,href:"/create/design/",children:"New"}),Object(S.jsx)(v.R,{leftIcon:"tag",id:"name_input",placeholder:"Design Name"}),Object(S.jsx)(v.g,{icon:"floppy-disk",minimal:!0,onClick:function(){e.props.clickSave()},children:"Save"}),Object(S.jsx)("span",{className:"feedback-tag bp3-tag bp3-intent-"+this.props.feedbackIntent+(this.props.feedbackHidden?" hidden":""),children:this.props.feedback})]}),Object(S.jsxs)(v.Z.Group,{align:m.a.RIGHT,children:[Object(S.jsx)("span",{className:"feedback-tag bp3-tag bp3-intent-"+this.props.webhookFeedbackIntent+(this.props.webhookFeedbackHidden?" hidden":""),children:this.props.webhookFeedback}),this.props.showAIOButton&&Object(S.jsx)(v.g,{minimal:!0,icon:"cloud-upload",onClick:this.props.showWebhookDialogClick,children:"Setup Adafruit.io Webhooks"}),this.props.showMyDesigns&&Object(S.jsx)(v.b,{minimal:!0,href:"/list/designs/",icon:"layout-grid",children:"My Designs"}),Object(S.jsx)(v.b,{icon:"download",minimal:!0,href:"/media/content/"+this.props.image_file+"?t="+(new Date).getTime(),children:"Download BMP"}),Object(S.jsx)(v.b,{minimal:!0,href:"/docs/",target:"_blank",icon:Object(S.jsx)(_.a,{className:"bp3-icon",style:{fontSize:"20px"}}),children:"Help"}),Object(S.jsx)(v.t,{})]})]})}}]),n}(o.a.Component),C=n(87),D=n.n(C),y=n(147),I=n(112),N=n(80),F=n(71),T=n(82),W=Object(f.observer)((function(e){var t=e.store,n=o.a.useState([]),a=Object(I.a)(n,2),s=a[0],i=a[1];function c(){return r.apply(this,arguments)}function r(){return(r=Object(y.a)(D.a.mark((function e(){var t,n,a;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=["adabot","billie","blinka","cappy","connie","gus","hans","mho","minerva","ruby","sparky"],n=[],a=0;a<t.length;a++)n.push({url:"/static/img/adafruit_".concat(t[a],"_emoji.png")});i(n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return o.a.useEffect((function(){c()}),[]),Object(S.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[Object(S.jsx)(v.R,{leftIcon:"search",placeholder:"Search...",onChange:function(e){c()},style:{marginBottom:"20px"}}),Object(S.jsx)("p",{children:"Demo images: "}),Object(S.jsx)(F.ImagesGrid,{images:s,getPreview:function(e){return e.url},onSelect:function(){var e=Object(y.a)(D.a.mark((function e(n,a){var o,s,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(N.getImageSize)(n.url);case 2:o=e.sent,s=o.width,i=o.height,t.activePage.addElement({type:"image",src:n.url,width:s,height:i,x:(null===a||void 0===a?void 0:a.x)||0,y:(null===a||void 0===a?void 0:a.y)||0});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),rowsNumber:2,isLoading:!s.length,loadMore:!1})]})})),H=n(37),J=n(2),P=n(59),A=n(32),E=n.n(A),U=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).handleOpen=function(){return a.setState({isOpen:!0})},a.handleClose=function(){a.setState({isOpen:!1}),a.props.handleClose()},console.log("props in constructor"),console.dir(a.props),a.state={isOpen:a.props.isOpen,autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,usePortal:!0,imageWebhook:a.props.preview_webhook_url,signatureWebhook:a.props.signature_webhook_url},console.log("signature webhook in constructor:"),console.log(a.state.signature_webhook_url),a.handleChangeSignatureWebhook=a.handleChangeSignatureWebhook.bind(Object(H.a)(a)),a.handleChangeImageWebhook=a.handleChangeImageWebhook.bind(Object(H.a)(a)),a}return Object(d.a)(n,[{key:"handleChangeSignatureWebhook",value:function(e){this.setState({signatureWebhook:e.target.value})}},{key:"handleChangeImageWebhook",value:function(e){console.log("setting image webhook"),console.log(e.target.value),this.setState({imageWebhook:e.target.value})}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return console.log("url : "+this.state.imageWebhook),Object(S.jsxs)(v.r,Object(c.a)(Object(c.a)({className:"",icon:"cloud-upload",onClose:this.handleClose,title:"Adafruit.io Webhook URLs"},this.state),{},{children:[Object(S.jsxs)("div",{className:J.g.DIALOG_BODY,children:[Object(S.jsx)("p",{children:"Image Preview Feed"}),Object(S.jsx)(v.R,{id:"preview_webhook_input",value:this.state.imageWebhook,onChange:this.handleChangeImageWebhook}),Object(S.jsx)("br",{}),Object(S.jsx)("p",{children:"Image Signature Feed"}),Object(S.jsx)(v.R,{id:"signature_webhook_input",value:this.state.signatureWebhook,onChange:this.handleChangeSignatureWebhook})]}),Object(S.jsx)("div",{className:J.g.DIALOG_FOOTER,children:Object(S.jsxs)("div",{className:J.g.DIALOG_FOOTER_ACTIONS,children:[Object(S.jsx)(v.g,{onClick:this.handleClose,children:"Close"}),Object(S.jsx)(v.g,{intent:P.a.SUCCESS,onClick:function(){e.handleClose(),e.props.saveWebhooksClick()},children:"Save"})]})})]}))}}]),n}(o.a.Component);U.getDerivedStateFromProps=function(e,t){return{isOpen:e.isOpen}};var R=U,L=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).handleOpen=function(){return a.setState({isOpen:!0})},a.handleClose=function(){a.setState({isOpen:!1}),a.props.handleClose()},a.state={isOpen:a.props.isOpen,autoFocus:!0,canEscapeKeyClose:!0,canOutsideClickClose:!0,enforceFocus:!0,usePortal:!0},a}return Object(d.a)(n,[{key:"render",value:function(){return Object(S.jsxs)(v.r,Object(c.a)(Object(c.a)({className:"",icon:"warning-sign",onClose:this.handleClose,title:"Guest User Warning"},this.state),{},{children:[Object(S.jsxs)("div",{className:J.g.DIALOG_BODY,children:[Object(S.jsx)("p",{children:"You are currently working on this design as a guest user. Once the design is saved, anyone who gets the design URL will be able to see and modify the design."}),Object(S.jsx)("p",{children:"To further secure your designs you can create user account. Designs created by signed in users will be inaccessible to anyone not signed in as the user who created it."}),Object(S.jsx)("p",{children:"Users can create and save unlimited different designs and easily access them."}),Object(S.jsxs)("p",{children:["Would you like to ",Object(S.jsx)("a",{href:"/accounts/login/",children:"Login"})," or ",Object(S.jsx)("a",{href:"/accounts/register/",children:"Create an account"}),"?"]})]}),Object(S.jsx)("div",{className:J.g.DIALOG_FOOTER,children:Object(S.jsx)("div",{className:J.g.DIALOG_FOOTER_ACTIONS,children:Object(S.jsx)(v.g,{onClick:this.handleClose,children:"Close"})})})]}))}}]),n}(o.a.Component);L.getDerivedStateFromProps=function(e,t){return console.log("updating state from props"),{isOpen:e.isOpen}};var G=L,B=n(75),M=n(143),z=n.n(M),q=n(26),Y=n(148),Z=n.n(Y),K=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).refHandlers={toaster:function(e){return a.toaster=e}},a.render=function(){console.log("input data inside render"),console.log(a.input_data);var e=""!==(a.input_data?a.input_data.data.username:"");return Object(S.jsxs)(o.a.Fragment,{children:[Object(S.jsx)(v.Hb,{position:q.a.TOP,ref:a.refHandlers.toaster,intent:P.a.DANGER}),Object(S.jsx)(R,{isOpen:a.state.webhookDialogOpen,saveWebhooksClick:a.saveWebhooksClick,handleClose:a.handleWebhooksDialogClose,preview_webhook_url:a.input_data?a.input_data.data.preview_webhook_url:"",signature_webhook_url:a.input_data?a.input_data.data.signature_webhook_url:""}),Object(S.jsx)(G,{isOpen:a.state.noUserWarningDialogOpen,handleClose:a.handleNoUserWarningDialogClose}),Object(S.jsx)(x,{store:a.store,clickSave:a.clickSave,clickSaveAIO:a.clickSaveAIO,feedbackHidden:a.state.feedbackHidden,feedbackIntent:a.state.feedbackIntent,feedback:a.state.feedback,webhookFeedbackHidden:a.state.webhookFeedbackHidden,webhookFeedbackIntent:a.state.webhookFeedbackIntent,webhookFeedback:a.state.webhookFeedback,codepyHidden:a.creating,showMyDesigns:e,showWebhookDialogClick:a.showWebhookDialog,uuid:a.creating?"":a.input_data.data.uuid,image_file:a.input_data?a.input_data.data.image_file:"",showAIOButton:!a.creating}),Object(S.jsxs)("div",{style:{display:"flex",height:"92vh",width:"100vw"},children:[Object(S.jsx)("div",{style:{width:"400px",height:"100%",display:"flex"},children:Object(S.jsx)(B.SidePanel,{store:a.store,sections:a.sections,defaultSection:"adafruit"})}),Object(S.jsxs)("div",{style:{display:"flex",height:"100%",margin:"auto",flex:1,flexDirection:"column",position:"relative"},children:[Object(S.jsx)(b.a,{store:a.store,downloadButtonEnabled:!1}),Object(S.jsx)(O.a,{store:a.store,pageControlsEnabled:!1}),Object(S.jsx)(p.a,{store:a.store})]})]})]})},a.saveWebhooksClick=function(){console.log("click save webhooks"),console.log(E()("#preview_webhook_input").val()),console.log(E()("#signature_webhook_input").val()),E.a.ajax({method:"POST",url:"/update/design/u/"+a.input_data.data.uuid+"/webhooks/",data:{preview_webhook:E()("#preview_webhook_input").val(),signature_webhook:E()("#signature_webhook_input").val()}}).done((function(e){a.input_data.data.preview_webhook_url=E()("#preview_webhook_input").val(),a.input_data.data.signature_webhook_url=E()("#signature_webhook_input").val(),console.log(e),a.setState({webhookFeedbackHidden:!1,webhookFeedbackIntent:"success",webhookFeedback:"Webhooks saved successfully"}),setTimeout((function(){a.setState({webhookFeedbackHidden:!0})}),3e3)})).error((function(e){a.setState({webhookFeedbackHidden:!1,webhookFeedbackIntent:"danger",webhookFeedback:e.responseJSON.error})}))},a.handleWebhooksDialogClose=function(){a.setState({webhookDialogOpen:!1})},a.handleNoUserWarningDialogClose=function(){a.setState({noUserWarningDialogOpen:!1})},a.showWebhookDialog=function(){console.log("showing webhook dialog"),a.setState({webhookDialogOpen:!0},(function(){console.log(a.state.webhookDialogOpen)}))},a.clickSave=function(){console.log("clicked save"),""!==E()("#name_input").val()?void 0!==a.input_data&&a.input_data.data.hasOwnProperty("id")?E.a.ajax({method:"POST",url:"/update/design/u/"+a.input_data.data.uuid+"/",data:{image_base64:a.store.toDataURL(),json:JSON.stringify(a.store.toJSON()),name:E()("#name_input").val()}}).done((function(e){a.setState({feedbackHidden:!1,feedbackIntent:"success",feedback:"Design saved successfully",savedDesignJson:a.store.toJSON()}),console.log(e),setTimeout((function(){a.setState({feedbackHidden:!0})}),3e3)})):E.a.ajax({method:"POST",url:"/create_design/",data:{image_base64:a.store.toDataURL(),json:JSON.stringify(a.store.toJSON()),name:E()("#name_input").val()}}).done((function(e){a.setState({feedbackHidden:!1,feedbackIntent:"success",feedback:"Design created successfully",savedDesignJson:a.store.toJSON()}),setTimeout((function(){a.setState({feedbackHidden:!0}),window.location=e.view_design_url}),3e3),console.log(e)})).fail((function(e){a.setState({feedbackHidden:!1,feedbackIntent:"danger",feedback:e.responseJSON.error})})):(a.setState({feedbackHidden:!1,feedbackIntent:"danger",feedback:"Design Name cannot be blank"}),setTimeout((function(){a.setState({feedbackHidden:!0})}),3e3))},a.clickSaveAIO=function(){console.log("clicked save"),void 0!==a.input_data&&a.input_data.data.hasOwnProperty("id")&&(console.log(a.store.toDataURL()),E.a.ajax({method:"POST",url:"/upload_aio/design/"+a.input_data.data.id+"/",data:{image_base64:a.store.toDataURL(),json:JSON.stringify(a.store.toJSON()),name:E()("#name_input").val()}}).done((function(e){a.setState({feedbackHidden:!1,feedbackIntent:"success",feedback:"Design saved successfully"}),console.log(e),setTimeout((function(){a.setState({feedbackHidden:!0})}),3e3)})))},console.log("starting the app..."),a.store=Object(j.createStore)({key:"urccVCzsiJVAkwUNpR_y"}),a.store.setSize(240,240),a.state={feedback:"Design Saved",feedbackIntent:"success",feedbackHidden:!0,webhookFeedback:"Design Saved",webhookFeedbackIntent:"success",webhookFeedbackHidden:!0,webhookDialogOpen:!1,savedDesignJson:{},noUserWarningDialogOpen:!1},a.creating=!0,a.input_data=E()("#root").data("props"),a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;E.a.ajaxSetup({beforeSend:function(t,n){var a;a=n.type,/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)||e.crossDomain||t.setRequestHeader("X-CSRFToken",e.getCookie("csrftoken"))}}),void 0!==this.input_data&&this.input_data.data.hasOwnProperty("design_json")?(this.creating=!1,console.log(this.store.activePage),this.store.loadJSON(JSON.parse(this.input_data.data.design_json)),console.dir(this.store.pages),console.log(this.store.activePage.id),E()("#name_input").val(this.input_data.data.name),this.setState({savedDesignJson:this.store.toJSON()})):(this.creating=!0,this.store.addPage(),this.setState({savedDesignJson:this.store.toJSON()})),console.log("username: ".concat(this.input_data.data.username)),void 0!==this.input_data&&this.input_data.data.hasOwnProperty("username")&&""===this.input_data.data.username&&(console.log("user was blank"),this.setState({noUserWarningDialogOpen:!0})),setTimeout((function(){e.store.setScale(1.5)}),300),setTimeout((function(){E()(".credit span a").attr("target","_blank")}),2e3),this.sections=B.DEFAULT_SECTIONS,console.log("sections: "),console.log(B.DEFAULT_SECTIONS);var t={name:"adafruit",Tab:function(e){return Object(S.jsx)(T.SectionTab,Object(c.a)(Object(c.a)({name:"Adafruit"},e),{},{children:Object(S.jsx)(z.a,{})}))},Panel:W};this.sections.splice(1,0,t),B.PhotosSection.Tab=function(e){return Object(S.jsx)(T.SectionTab,Object(c.a)(Object(c.a)({name:"Unsplash"},e),{},{children:Object(S.jsx)(v.P,{icon:"media"})}))},E()(window).on("beforeunload",(function(){if(console.log("state in beforeunload"),console.dir(e.state.savedDesignJson),console.log("----"),console.dir(e.store.toJSON()),console.log("json has changed ? "+!Z.a.isEqual(e.state.savedDesignJson,e.store.toJSON())),console.log("history"),console.log(e.store.history.canUndo),!Z.a.isEqual(e.state.savedDesignJson,e.store.toJSON()))return"Are you sure to leave? There is unsaved worked."})),this.forceUpdate()}},{key:"getCookie",value:function(e){var t=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var o=E.a.trim(n[a]);if(o.substring(0,e.length+1)==e+"="){t=decodeURIComponent(o.substring(e.length+1));break}}return t}}]),n}(o.a.Component),V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,399)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),o(e),s(e),i(e)}))};i.a.render(Object(S.jsx)(o.a.StrictMode,{children:Object(S.jsx)(K,{})}),document.getElementById("root")),V()}},[[392,1,2]]]);
//# sourceMappingURL=main.aa741582.chunk.js.map